<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Выбор даты</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #ffffff; /* fallback */
            color: #000000; /* fallback */
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .container {
            width: 100%;
            max-width: 400px;
        }

        h1 {
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            color: #000000; /* fallback */
        }

        .calendar {
            background: #f0f0f0; /* fallback для secondary-bg */
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .month-year {
            font-size: 18px;
            font-weight: 600;
            color: #000000; /* fallback */
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000000; /* fallback */
            transition: background 0.2s;
        }

        .nav-btn:hover {
            background: #e0e0e0; /* fallback для hint */
        }

        .weekdays {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
            margin-bottom: 10px;
        }

        .weekday {
            text-align: center;
            font-size: 14px;
            color: #888888; /* fallback для hint */
            font-weight: 500;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 5px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            cursor: pointer;
            border-radius: 50%;
            transition: background 0.2s, color 0.2s;
            color: #000000; /* fallback */
        }

        .day.other-month {
            color: #888888; /* fallback */
            pointer-events: none;
        }

        .day.today {
            background: #e0e0e0; /* fallback */
        }

        .day.selected {
            background: #007aff; /* fallback для button */
            color: #ffffff; /* fallback для button-text */
        }

        .day:hover:not(.other-month):not(.selected) {
            background: #e0e0e0; /* fallback */
        }

        #confirmBtn {
            width: 100%;
            padding: 15px;
            background: #007aff; /* fallback */
            color: #ffffff; /* fallback */
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: opacity 0.2s;
            margin-top: 10px;
        }

        #confirmBtn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        #selectedDate {
            text-align: center;
            margin-top: 10px;
            font-size: 16px;
            color: #000000; /* fallback */
        }

        .holiday {
            color: #007aff; /* fallback */
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Выберите дату</h1>
        <div class="calendar">
            <div class="calendar-header">
                <button class="nav-btn" id="prevMonth">&lt;</button>
                <span class="month-year" id="monthYear"></span>
                <button class="nav-btn" id="nextMonth">&gt;</button>
            </div>
            <div class="weekdays">
                <div class="weekday">Пн</div>
                <div class="weekday">Вт</div>
                <div class="weekday">Ср</div>
                <div class="weekday">Чт</div>
                <div class="weekday">Пт</div>
                <div class="weekday">Сб</div>
                <div class="weekday">Вс</div>
            </div>
            <div class="days-grid" id="daysGrid"></div>
        </div>
        <div id="selectedDate">Выбрано: не выбрано</div>
        <button id="confirmBtn" disabled>Подтвердить</button>
    </div>

   <script>
  const tg = window.Telegram.WebApp;
  tg.ready();
  tg.expand();

  const elements = {
    monthYear: document.getElementById('monthYear'),
    prevMonth: document.getElementById('prevMonth'),
    nextMonth: document.getElementById('nextMonth'),
    daysContainer: document.getElementById('daysContainer'),
    selectedDateEl: document.getElementById('selectedDate'),
    confirmBtn: document.getElementById('confirmBtn')
  };

  let currentDate = new Date();
  let selectedDate = new Date(); // ← текущая дата выбрана по умолчанию

  const monthNames = ["января", "февраля", "марта", "апреля", "мая", "июня",
    "июля", "августа", "сентября", "октября", "ноября", "декабря"];

  function renderCalendar() {
    elements.daysContainer.innerHTML = '';
    const year = currentDate.getFullYear();
    const month = currentDate.getMonth();

    elements.monthYear.textContent = `${monthNames[month]} ${year}`;

    const firstDay = new Date(year, month, 1).getDay();
    const daysInMonth = new Date(year, month + 1, 0).getDate();

    // Пустые ячейки до первого дня
    for (let i = 0; i < (firstDay === 0 ? 6 : firstDay - 1); i++) {
      const empty = document.createElement('div');
      empty.classList.add('day', 'empty');
      elements.daysContainer.appendChild(empty);
    }

    // Дни месяца
    for (let day = 1; day <= daysInMonth; day++) {
      const dayEl = document.createElement('div');
      dayEl.classList.add('day');
      dayEl.textContent = day;

      const dayDate = new Date(year, month, day);
      if (dayDate.toDateString() === selectedDate.toDateString()) {
        dayEl.classList.add('selected');
      }

      // Прошедшие даты отключены
      if (dayDate < new Date().setHours(0,0,0,0)) {
        dayEl.classList.add('disabled');
      } else {
        dayEl.addEventListener('click', () => {
          selectedDate = dayDate;
          updateSelectedDisplay();
          renderCalendar();
        });
      }

      elements.daysContainer.appendChild(dayEl);
    }

    updateSelectedDisplay();
    elements.confirmBtn.disabled = false; // ← всегда активна, т.к. есть дефолт
  }

  function updateSelectedDisplay() {
    elements.selectedDateEl.textContent = `Выбрано: ${formatDateDisplay(selectedDate)}`;
  }

  function formatDate(date) {
    const year = date.getFullYear();
    const month = String(date.getMonth() + 1).padStart(2, '0');
    const day = String(date.getDate()).padStart(2, '0');
    return `${year}-${month}-${day}`;
  }

  function formatDateDisplay(date) {
    const day = date.getDate();
    const month = monthNames[date.getMonth()];
    const year = date.getFullYear();
    return `${day} ${month} ${year} г.`;
  }

  elements.prevMonth.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() - 1);
    renderCalendar();
  });

  elements.nextMonth.addEventListener('click', () => {
    currentDate.setMonth(currentDate.getMonth() + 1);
    renderCalendar();
  });

  elements.confirmBtn.addEventListener('click', () => {
    const dateStr = formatDate(selectedDate);
    tg.sendData(dateStr);
    tg.close();
  });

  renderCalendar();
</script>
</body>
</html>
